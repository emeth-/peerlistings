{% extends "master.html" %}
{% block buy_nav %} class='active'{% endblock %}

{% block additional_css %}
	td.details-control {
		background: url('/static/images/details_open.png') no-repeat center center;
		cursor: pointer;
	}

	tr.shown td.details-control {
		background: url('/static/images/details_close.png') no-repeat center center;
	}

	tr.loading td {
		text-align: center;
	}
{% endblock %}


{% block additional_js %}

function format ( rowData ) {
	var div = $('<div/>')
		.addClass( 'loading' )
		.text( 'Loading...' );

	//$.ajax( {
	//	url: '/media/blog/2017-03-31/details.php',
	//	data: {
	//		name: rowData.name
	//	},
	//	dataType: 'json',
	//	type: 'post',
	//	success: function ( json ) {
	//		div
	//			.html( json.html )
	//			.removeClass( 'loading' );
	//	}
	//} );
    div.html("Profile details here").removeClass( 'loading' );

	return div;
}

$(document).ready(function() {
	var dtable = $('#myTable').DataTable( {
		"columns": [
			{
				"className":      'details-control',
				"orderable":      false,
				"data":           null,
				"defaultContent": ''
			},
            {
                data: 'game_name',
                name: 'game_name',
                render: function (a, b, obj, d) {
                    return obj.game_name;
                },
                title: 'Game'
            },
            {
                data: 'currency_name',
                name: 'currency_name',
                render: function (a, b, obj, d) {
                    return obj.currency_name;
                },
                title: 'Currency'
            },
            {
                data: 'currency_amount',
                name: 'currency_amount',
                render: function (a, b, obj, d) {
                    return obj.currency_amount;
                },
                title: 'Amount'
            },
            {
                data: 'cost',
                name: 'cost',
                render: function (a, b, obj, d) {
                    return obj.cost;
                },
                title: 'Cost (PPC)'
            },
		],
		"order": [[1, 'asc']],
        serverSide: true,
        lengthChange: false,
        processing: true,
        dom: 't<"bottom"ip>',
        ajax: {
            url: '/get_datatable_data',
            type: 'GET',
            "data": function(d) {
              d.gamename_filter = gamename_filter;
            }
        },
        pageLength: 10,
	} );

	// Add event listener for opening and closing details
	$('#myTable tbody').on('click', 'td.details-control', function () {
		var tr = $(this).closest('tr');
		var row = dtable.row( tr );

		if ( row.child.isShown() ) {
			// This row is already open - close it
			row.child.hide();
			tr.removeClass('shown');
		}
		else {
			// Open this row
			row.child( format(row.data()) ).show();
			tr.addClass('shown');
		}
	} );


  this.gamename_magic = $('#gamename_magic').magicSuggest({
      allowFreeEntries: false,
      expandOnFocus: true,
      useTabKey: true,
      valueField: 'id',
      displayField: 'name',
      maxSelection: 1,
      data: function (query) {
          return '/autocomplete/gamename/?query=' + encodeURIComponent(query);
      },
  });


  $(this.gamename_magic).on('selectionchange', function (event, ms) {
      var selected_value_list = this.getValue();
      gamename_filter = selected_value_list[0];
      dtable.draw();
  });

} );

var gamename_filter;
var dtable;

{% endblock %}

{% block content %}

    <!-- Main jumbotron for a primary marketing message or call to action -->
    <div class="jumbotron" style="padding-top: 10px !important; padding-bottom: 10px !important">
      <div class="container">
        <div class="col-sm-6">
            <div class="form-group">
                <label for="gamename_magic">Game Name Filter</label><br>
                    <div id="gamename_magic"></div>
                    <input type="text" class="form-control input-sm input-sm" id="gamename_id" value="" style="display:none">
            </div>
        </div>
      </div>

    </div>

    <div class="container">


<table id="myTable" class="display" width="100%">
    <thead>
        <tr>
            <th></th>
            <th>Game</th>
            <th>Currency</th>
            <th>Amount</th>
            <th>Cost (PPC)</th>
        </tr>
    </thead>
    <tfoot>
        <tr>
            <th></th>
            <th>Game</th>
            <th>Currency</th>
            <th>Amount</th>
            <th>Cost (PPC)</th>
        </tr>
    </tfoot>
</table>

{% endblock %}